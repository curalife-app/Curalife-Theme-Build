{% comment %}
	Section that provides a flexible column layout.
	Merchants add 'Column Content' blocks, which then accept nested content blocks.
{% endcomment %}

{% assign section_id = section.id %}
{% assign columns = section.settings.columns | default: 2 %}
{% assign columns_mobile = section.settings.columns_mobile | default: 1 %}
{% assign column_gap = section.settings.column_gap | default: 4 %}

<style>
	#section-{{ section_id }} .columns-layout-flex {
		display: flex;
		gap: {{ column_gap }}rem;
	}
	#section-{{ section_id }} .columns-layout-column {
		/* Default flex behavior will be overridden inline based on column settings */
		flex-grow: 0;
		flex-shrink: 0;
	}
	@media (max-width: 768px) {
		#section-{{ section_id }} .columns-layout-flex {
			gap: {{ column_gap | times: 0.75 | default: 1 }}rem;
		}
		#section-{{ section_id }} .columns-layout-column {
			flex-basis: 100% !important;
		}
		{% if columns_mobile == '2' %}
			#section-{{ section_id }} .columns-layout-column {
				flex-basis: calc(50% - {{ column_gap | times: 0.375 }}rem) !important;
			}
		{% endif %}
	}
</style>

<section
	id="section-{{ section_id }}"
	class="columns-layout-section"
	data-section-id="{{ section_id }}"
	data-section-type="columns-layout">
	<div class="container mx-auto px-4 py-8">
		{% if section.settings.title != blank %}
			<h2 class="text-center text-2xl mb-6">{{ section.settings.title }}</h2>
		{% endif %}

		<div class="columns-layout-flex">
			{% for block in section.blocks %}
				{%- assign default_col_span = 12 | divided_by: columns | default: 1 -%}
				{%- assign col_width = block.settings.column_width | default: default_col_span -%}
				{%- assign column_percent = col_width | times: 100 | divided_by: 12 -%}
				{%- assign gap_compensation = column_gap | times: col_width | divided_by: 12 | times: 0.5 -%}
				{%- assign column_flex_style = 'flex-basis: calc(' | append: column_percent | append: '% - ' | append: gap_compensation | append: 'rem);' -%}
				<div class="columns-layout-column" style="{{ column_flex_style }}">
					{% render block %}
				</div>
			{% endfor %}
		</div>
	</div>
</section>

{% schema %}
	{
		"name": "Columns Layout",
		"tag": "section",
		"class": "columns-layout-section",
		"settings": [
			{
				"type": "text",
				"id": "title",
				"label": "Section Title (Optional)"
			},
			{
				"type": "range",
				"id": "columns",
				"label": "Columns (Desktop)",
				"min": 1,
				"max": 6,
				"step": 1,
				"default": 2
			},
			{
				"type": "select",
				"id": "columns_mobile",
				"label": "Columns (Mobile)",
				"options": [
					{ "value": "1", "label": "1 column" },
					{ "value": "2", "label": "2 columns" }
				],
				"default": "1"
			},
			{
				"type": "range",
				"id": "column_gap",
				"label": "Column Gap (Desktop)",
				"min": 0,
				"max": 8,
				"step": 1,
				"unit": "rem",
				"default": 4
			}
		],
		"blocks": [{ "type": "@theme" }, { "type": "@app" }],
		"presets": [
			{
				"name": "Columns Layout (Empty)",
				"blocks": [{ "type": "column-content" }, { "type": "column-content" }]
			},
			{
				"name": "Two Columns with Heading & Text",
				"settings": {
					"columns": 2
				},
				"blocks": [
					{
						"type": "column-content",
						"blocks": [
							{
								"type": "text-block",
								"settings": {
									"text": "<h2>Example Heading</h2>",
									"text_color": "#1f2937"
								}
							}
						]
					},
					{
						"type": "column-content",
						"blocks": [
							{
								"type": "text-block",
								"settings": {
									"text": "<p>Use this section to explain a concept or feature. Add more blocks like images or buttons below.</p>",
									"text_color": "#6b7280"
								}
							}
						]
					}
				]
			}
		]
	}
{% endschema %}
