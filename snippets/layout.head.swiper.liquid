{% assign loadOnPages = "/pages/lp-wl-curaslim-360-price,/pages/reasons-why-curalin-for-blood-sugar-maintenance,/pages/lp-glu-4-reasons-select,/pages/lp-glu-curalin-v4-select,/pages/lp-wl-curaslim-prp-select,/pages/lp-wl-curaslim-360-select,/pages/glucose-support-curalin-pack-v4-new" | split: ',' %}
{% assign currentPage = request.path %}

{% if loadOnPages contains currentPage or currentPage contains '/products/' or Activate or false %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>console.log("Swiper loaded! (on Liquid)");</script>
{% endif %}

<script>
  window.isSwiperLoaded = window.isSwiperLoaded || false;
  window.isSwiperLoading = window.isSwiperLoading || false;

  function loadSwiper(initializeCallback) {
    if (window.isSwiperLoaded) {
      if (typeof initializeCallback === "function") {
        initializeCallback();
      }
      return;
    }

    if (window.isSwiperLoading) {
      // Swiper is currently loading; wait until it's loaded
      var checkSwiperInterval = setInterval(function() {
        if (window.isSwiperLoaded) {
          clearInterval(checkSwiperInterval);
          if (typeof initializeCallback === "function") {
            initializeCallback();
          }
        }
      }, 50);
      return;
    }

    // Start loading Swiper scripts
    window.isSwiperLoading = true;

    // Load Swiper CSS
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = "https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css";
    document.head.appendChild(link);

    // Load Swiper JS
    const script = document.createElement("script");
    script.src = "https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js";
    script.onload = () => {
      window.isSwiperLoaded = true;
      window.isSwiperLoading = false;
      console.log("Swiper loaded dynamically");

      if (typeof initializeCallback === "function") {
        initializeCallback();
      }
    };
    script.onerror = () => {
      console.error("Failed to load Swiper");
      window.isSwiperLoading = false;
    };
    document.body.appendChild(script);
  }

  // Function to initialize Swiper
  function initializeSwiper(swiperElementSelector, swiperOptions) {
    if (typeof Swiper !== 'undefined') {
      console.log("Initializing Swiper for", swiperElementSelector);
      return new Swiper(swiperElementSelector, swiperOptions);
    } else {
      console.error("Swiper is not loaded yet");
      return null;
    }
  }
</script>
