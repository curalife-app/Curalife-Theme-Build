import"./pubsub-chunk.js";function S(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}class d extends SearchForm{constructor(){super(),this.cachedResults={},this.predictiveSearchResults=this.querySelector("[data-predictive-search]"),this.allPredictiveSearchInstances=document.querySelectorAll("predictive-search"),this.isOpen=!1,this.abortController=new AbortController,this.searchTerm="",this.setupEventListeners()}setupEventListeners(){this.input.form.addEventListener("submit",this.onFormSubmit.bind(this)),this.input.addEventListener("focus",this.onFocus.bind(this)),this.addEventListener("focusout",this.onFocusOut.bind(this)),this.addEventListener("keyup",this.onKeyup.bind(this)),this.addEventListener("keydown",this.onKeydown.bind(this))}getQuery(){return this.input.value.trim()}onChange(){var t;super.onChange();const e=this.getQuery();if((!this.searchTerm||!e.startsWith(this.searchTerm))&&((t=this.querySelector("#predictive-search-results-groups-wrapper"))==null||t.remove()),this.updateSearchForTerm(this.searchTerm,e),this.searchTerm=e,!this.searchTerm.length){this.close(!0);return}this.getSearchResults(this.searchTerm)}onFormSubmit(e){(!this.getQuery().length||this.querySelector('[aria-selected="true"] a'))&&e.preventDefault()}onFormReset(e){super.onFormReset(e),super.shouldResetForm()&&(this.searchTerm="",this.abortController.abort(),this.abortController=new AbortController,this.closeResults(!0))}onFocus(){const e=this.getQuery();e.length&&(this.searchTerm!==e?this.onChange():this.getAttribute("results")==="true"?this.open():this.getSearchResults(this.searchTerm))}onFocusOut(){setTimeout(()=>{this.contains(document.activeElement)||this.close()})}onKeyup(e){switch(this.getQuery().length||this.close(!0),e.preventDefault(),e.code){case"ArrowUp":this.switchOption("up");break;case"ArrowDown":this.switchOption("down");break;case"Enter":this.selectOption();break}}onKeydown(e){(e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()}updateSearchForTerm(e,t){const s=this.querySelector("[data-predictive-search-search-for-text]"),r=s==null?void 0:s.innerText;if(r){if(r.match(new RegExp(e,"g")).length>1)return;const n=r.replace(e,t);s.innerText=n}}switchOption(e){if(!this.getAttribute("open"))return;const t=e==="up",s=this.querySelector('[aria-selected="true"]'),r=Array.from(this.querySelectorAll("li, button.predictive-search__item")).filter(l=>l.offsetParent!==null);let n=0;if(t&&!s)return;let o=-1,a=0;for(;o===-1&&a<=r.length;)r[a]===s&&(o=a),a++;if(this.statusElement.textContent="",!t&&s?n=o===r.length-1?0:o+1:t&&(n=o===0?r.length-1:o-1),n===o)return;const c=r[n];c.setAttribute("aria-selected",!0),s&&s.setAttribute("aria-selected",!1),this.input.setAttribute("aria-activedescendant",c.id)}selectOption(){const e=this.querySelector('[aria-selected="true"] a, button[aria-selected="true"]');e&&e.click()}getSearchResults(e){const t=e.replace(" ","-").toLowerCase();if(this.setLiveRegionLoadingState(),this.cachedResults[t]){this.renderSearchResults(this.cachedResults[t]);return}fetch("".concat(routes.predictive_search_url,"?q=").concat(encodeURIComponent(e),"&section_id=predictive-search"),{signal:this.abortController.signal}).then(s=>{if(!s.ok){var r=new Error(s.status);throw this.close(),r}return s.text()}).then(s=>{const r=new DOMParser().parseFromString(s,"text/html").querySelector("#shopify-section-predictive-search").innerHTML;this.allPredictiveSearchInstances.forEach(n=>{n.cachedResults[t]=r}),this.renderSearchResults(r)}).catch(s=>{if((s==null?void 0:s.code)!==20)throw this.close(),s})}setLiveRegionLoadingState(){this.statusElement=this.statusElement||this.querySelector(".predictive-search-status"),this.loadingText=this.loadingText||this.getAttribute("data-loading-text"),this.setLiveRegionText(this.loadingText),this.setAttribute("loading",!0)}setLiveRegionText(e){this.statusElement.setAttribute("aria-hidden","false"),this.statusElement.textContent=e,setTimeout(()=>{this.statusElement.setAttribute("aria-hidden","true")},1e3)}renderSearchResults(e){this.predictiveSearchResults.innerHTML=e,this.setAttribute("results",!0),this.setLiveRegionResults(),this.open()}setLiveRegionResults(){this.removeAttribute("loading"),this.setLiveRegionText(this.querySelector("[data-predictive-search-live-region-count-value]").textContent)}getResultsMaxHeight(){return this.resultsMaxHeight=window.innerHeight-document.querySelector(".section-header").getBoundingClientRect().bottom,this.resultsMaxHeight}open(){this.predictiveSearchResults.style.maxHeight=this.resultsMaxHeight||"".concat(this.getResultsMaxHeight(),"px"),this.setAttribute("open",!0),this.input.setAttribute("aria-expanded",!0),this.isOpen=!0}close(e=!1){this.closeResults(e),this.isOpen=!1}closeResults(e=!1){e&&(this.input.value="",this.removeAttribute("results"));const t=this.querySelector('[aria-selected="true"]');t&&t.setAttribute("aria-selected",!1),this.input.setAttribute("aria-activedescendant",""),this.removeAttribute("loading"),this.removeAttribute("open"),this.input.setAttribute("aria-expanded",!1),this.resultsMaxHeight=!1,this.predictiveSearchResults.removeAttribute("style")}}customElements.define("predictive-search",d);let m=class extends HTMLElement{constructor(){super(),this.input=this.querySelector('input[type="search"]'),this.resetButton=this.querySelector('button[type="reset"]'),this.input&&(this.input.form.addEventListener("reset",this.onFormReset.bind(this)),this.input.addEventListener("input",debounce(e=>{this.onChange(e)},300).bind(this)))}toggleResetButton(){const e=this.resetButton.classList.contains("hidden");this.input.value.length>0&&e?this.resetButton.classList.remove("hidden"):this.input.value.length===0&&!e&&this.resetButton.classList.add("hidden")}onChange(){this.toggleResetButton()}shouldResetForm(){return!document.querySelector('[aria-selected="true"] a')}onFormReset(e){e.preventDefault(),this.shouldResetForm()&&(this.input.value="",this.input.focus(),this.toggleResetButton())}};customElements.define("search-form",m);class f extends SearchForm{constructor(){super(),this.allSearchInputs=document.querySelectorAll('input[type="search"]'),this.setupEventListeners()}setupEventListeners(){let e=[];this.allSearchInputs.forEach(t=>e.push(t.form)),this.input.addEventListener("focus",this.onInputFocus.bind(this)),!(e.length<2)&&(e.forEach(t=>t.addEventListener("reset",this.onFormReset.bind(this))),this.allSearchInputs.forEach(t=>t.addEventListener("input",this.onInput.bind(this))))}onFormReset(e){super.onFormReset(e),super.shouldResetForm()&&this.keepInSync("",this.input)}onInput(e){const t=e.target;this.keepInSync(t.value,t)}onInputFocus(){window.innerWidth<750&&this.scrollIntoView({behavior:"smooth"})}keepInSync(e,t){this.allSearchInputs.forEach(s=>{s!==t&&(s.value=e)})}}customElements.define("main-search",f);class i extends HTMLElement{constructor(){super(),this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=debounce(s=>{this.onSubmitHandler(s)},500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this));const t=this.querySelector("#FacetsWrapperDesktop");t&&t.addEventListener("keyup",onKeyUpEscape)}static setListeners(){const e=t=>{const s=t.state?t.state.searchParams:i.searchParamsInitial;s!==i.searchParamsPrev&&i.renderPage(s,null,!1)};window.addEventListener("popstate",e)}static toggleActiveFacets(e=!0){document.querySelectorAll(".js-facet-remove").forEach(t=>{t.classList.toggle("disabled",e)})}static renderPage(e,t,s=!0){i.searchParamsPrev=e;const r=i.getSections(),n=document.getElementById("ProductCount"),o=document.getElementById("ProductCountDesktop");document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading"),n&&n.classList.add("loading"),o&&o.classList.add("loading"),r.forEach(a=>{const c="".concat(window.location.pathname,"?section_id=").concat(a.section,"&").concat(e),l=h=>h.url===c;i.filterData.some(l)?i.renderSectionFromCache(l,t):i.renderSectionFromFetch(c,t)}),s&&i.updateURLHash(e)}static renderSectionFromFetch(e,t){fetch(e).then(s=>s.text()).then(s=>{const r=s;i.filterData=[...i.filterData,{html:r,url:e}],i.renderFilters(r,t),i.renderProductGridContainer(r),i.renderProductCount(r)})}static renderSectionFromCache(e,t){const s=i.filterData.find(e).html;i.renderFilters(s,t),i.renderProductGridContainer(s),i.renderProductCount(s)}static renderProductGridContainer(e){document.getElementById("ProductGridContainer").innerHTML=new DOMParser().parseFromString(e,"text/html").getElementById("ProductGridContainer").innerHTML}static renderProductCount(e){const t=new DOMParser().parseFromString(e,"text/html").getElementById("ProductCount").innerHTML,s=document.getElementById("ProductCount"),r=document.getElementById("ProductCountDesktop");s.innerHTML=t,s.classList.remove("loading"),r&&(r.innerHTML=t,r.classList.remove("loading"))}static renderFilters(e,t){const s=new DOMParser().parseFromString(e,"text/html"),r=s.querySelectorAll("#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersPillsForm .js-filter"),n=c=>{const l=t?t.target.closest(".js-filter"):void 0;return l?c.dataset.index===l.dataset.index:!1},o=Array.from(r).filter(c=>!n(c)),a=Array.from(r).find(n);o.forEach(c=>{document.querySelector('.js-filter[data-index="'.concat(c.dataset.index,'"]')).innerHTML=c.innerHTML}),i.renderActiveFacets(s),i.renderAdditionalElements(s),a&&i.renderCounts(a,t.target.closest(".js-filter"))}static renderActiveFacets(e){[".active-facets-mobile",".active-facets-desktop"].forEach(s=>{const r=e.querySelector(s);r&&(document.querySelector(s).innerHTML=r.innerHTML)}),i.toggleActiveFacets(!1)}static renderAdditionalElements(e){[".mobile-facets__open",".mobile-facets__count",".sorting"].forEach(s=>{e.querySelector(s)&&(document.querySelector(s).innerHTML=e.querySelector(s).innerHTML)}),document.getElementById("FacetFiltersFormMobile").closest("menu-drawer").bindEvents()}static renderCounts(e,t){const s=t.querySelector(".facets__selected"),r=e.querySelector(".facets__selected"),n=t.querySelector(".facets__summary"),o=e.querySelector(".facets__summary");r&&s&&(t.querySelector(".facets__selected").outerHTML=e.querySelector(".facets__selected").outerHTML),n&&o&&(t.querySelector(".facets__summary").outerHTML=e.querySelector(".facets__summary").outerHTML)}static updateURLHash(e){history.pushState({searchParams:e},"","".concat(window.location.pathname).concat(e&&"?".concat(e)))}static getSections(){return[{section:document.getElementById("product-grid").dataset.id}]}createSearchParams(e){const t=new FormData(e);return new URLSearchParams(t).toString()}onSubmitForm(e,t){i.renderPage(e,t)}onSubmitHandler(e){e.preventDefault();const t=document.querySelectorAll("facet-filters-form form");if(e.srcElement.className=="mobile-facets__checkbox"){const s=this.createSearchParams(e.target.closest("form"));this.onSubmitForm(s,e)}else{const s=[],r=e.target.closest("form").id==="FacetFiltersFormMobile";t.forEach(n=>{r?n.id==="FacetFiltersFormMobile"&&s.push(this.createSearchParams(n)):(n.id==="FacetSortForm"||n.id==="FacetFiltersForm"||n.id==="FacetSortDrawerForm")&&(document.querySelectorAll(".no-js-list").forEach(a=>a.remove()),s.push(this.createSearchParams(n)))}),this.onSubmitForm(s.join("&"),e)}}onActiveFilterClick(e){e.preventDefault(),i.toggleActiveFacets();const t=e.currentTarget.href.indexOf("?")==-1?"":e.currentTarget.href.slice(e.currentTarget.href.indexOf("?")+1);i.renderPage(t)}}i.filterData=[];i.searchParamsInitial=window.location.search.slice(1);i.searchParamsPrev=window.location.search.slice(1);customElements.define("facet-filters-form",i);i.setListeners();class p extends HTMLElement{constructor(){super(),this.querySelectorAll("input").forEach(e=>e.addEventListener("change",this.onRangeChange.bind(this))),this.setMinAndMaxValues()}onRangeChange(e){this.adjustToValidValues(e.currentTarget),this.setMinAndMaxValues()}setMinAndMaxValues(){const e=this.querySelectorAll("input"),t=e[0],s=e[1];s.value&&t.setAttribute("max",s.value),t.value&&s.setAttribute("min",t.value),t.value===""&&s.setAttribute("min",0),s.value===""&&t.setAttribute("max",s.getAttribute("max"))}adjustToValidValues(e){const t=Number(e.value),s=Number(e.getAttribute("min")),r=Number(e.getAttribute("max"));t<s&&(e.value=s),t>r&&(e.value=r)}}customElements.define("price-range",p);class g extends HTMLElement{constructor(){super();const e=this.querySelector("a");e.setAttribute("role","button"),e.addEventListener("click",this.closeFilter.bind(this)),e.addEventListener("keyup",t=>{t.preventDefault(),t.code.toUpperCase()==="SPACE"&&this.closeFilter(t)})}closeFilter(e){e.preventDefault(),(this.closest("facet-filters-form")||document.querySelector("facet-filters-form")).onActiveFilterClick(e)}}customElements.define("facet-remove",g);console.log("üîç Search bundle loaded - Search functionality initialized");export{S as __vite_legacy_guard};
