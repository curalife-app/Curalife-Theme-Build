{% comment %}
  Password Recovery Component
  - Handles password recovery form
  - Maintains accessibility standards
  - Matches login page styling
{% endcomment %}

<section class="customer login">
  <div class="container">
    <div class="recover-form" id="recover">
      <h2 tabindex="-1">{{section.settings.rst_titl}}</h2>
      <p>{{section.settings.rst_sbtitl}}</p>

      {%- form 'recover_customer_password', id:'rst_popup' -%}
        {% assign recover_success = form.posted_successfully? %}

        {%- if form.errors -%}
          <div id="RecoverEmail-email-error" class="form__message form__message--error">
            {% render 'icon-error' %}
            {{ form.errors | default_errors }}
          </div>
        {%- endif -%}

        <div class="field">
          <input
            type="email"
            name="email"
            id="recover-email"
            autocomplete="email"
            autocorrect="off"
            autocapitalize="off"
            {% if form.errors %}
              aria-invalid="true"
              aria-describedby="RecoverEmail-email-error"
              autofocus
            {% endif %}
            placeholder="Email"
          >
          <label for="recover-email">Email</label>
        </div>

        <button id="submit_reset_btn" type="submit" class="button button--primary">
          Submit
        </button>

        <div class="extra-action">
          <div class="link-group">
            <a href="/account/login">Back to login</a>
          </div>
        </div>
      {%- endform -%}
    </div>
  </div>
</section>

<style>
  /* Base Styles */
  :root {
    --form-max-width: 450px;
    --form-padding: clamp(20px, 5vw, 40px);
    --input-height: 48px;
    --border-radius: 8px;

    /* Colors - Using CSS variables for theming */
    --color-primary: var(--primary-color, #4a7c7d);
    --color-primary-dark: var(--primary-color-dark, #3a6162);
    --color-primary-light: rgba(74, 124, 125, 0.1);
    --color-text: var(--heading-color, #2c3338);
    --color-text-light: #666;
    --color-border: #e0e0e0;
    --color-error: #dc3545;
    --color-success: #28a745;
    --color-background: white;

    /* Shadows */
    --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.08);
    --shadow-focus: 0 0 0 3px var(--color-primary-light);
  }

  main {
    background: linear-gradient(135deg, var(--beige) 0%, #f5f5f5 100%);
    display: grid;
    place-items: center;
    padding: 2rem;
  }

  .shopify-section {
    @media (max-width: 768px) {
      width: 90%;
    }
  }

  form {
    min-height: 370px;
  }

  .customer.login {
    width: min(var(--form-max-width), 100%);
    margin: 0 auto;

    .recover-form {
      display: block;
      opacity: 1;
    }

    .container {
      background: var(--color-background);
      border-radius: var(--border-radius);
      padding: var(--form-padding);
      box-shadow: var(--shadow-card);
      position: relative;
      overflow: hidden;

      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(to right, var(--color-primary), var(--color-primary-dark));
      }
    }

    /* Typography */
    h1, h2 {
      color: var(--color-text);
      text-align: center;
      margin-bottom: 1rem;
      font-size: clamp(24px, 5vw, 32px);
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    p {
      color: var(--color-text-light);
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1rem;
      line-height: 1.5;
    }

    /* Form Fields */
    .field {
      position: relative;
      margin-bottom: 1rem;

      input {
        width: 100%;
        height: var(--input-height);
        padding: 0.75rem 1rem;
        border: 2px solid var(--color-border);
        border-radius: var(--border-radius);
        font-size: 1rem;
        background: var(--color-background);
        transition: all 0.2s ease-in-out;

        &:focus {
          outline: none;
          border-color: var(--color-primary);
          box-shadow: var(--shadow-focus);
        }

        &::placeholder {
          color: transparent;
        }

        &:focus + label,
        &:not(:placeholder-shown) + label {
          top: -8px;
          left: 12px;
          transform: translateY(0);
          font-size: 0.875rem;
          color: var(--color-primary);
          background: var(--color-background);
          padding: 0 6px;
        }
      }

      label {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1rem;
        color: var(--color-text-light);
        background: transparent;
        padding: 0 0.25rem;
        transition: all 0.2s ease-in-out;
        pointer-events: none;
      }
    }

    /* Buttons */
    .button {
      display: inline-block;
      width: 100%;
      padding: 0.875rem;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease-in-out;

      &--primary {
        background: linear-gradient(to right, var(--color-primary), var(--color-primary-dark));
        color: white;

        &:hover {
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(74, 124, 125, 0.2);
        }
      }
    }

    /* Links */
    .link-group {
      margin-top: 1.5rem;
      text-align: center;

      a {
        display: inline-block;
        color: var(--color-primary);
        text-decoration: none;
        font-size: 0.875rem;
        margin: 0.5rem 1rem;
        transition: all 0.2s ease-in-out;

        &:hover {
          color: var(--color-primary-dark);
          transform: translateY(-1px);
        }
      }
    }

    /* Messages */
    .form__message {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      border-radius: var(--border-radius);
      font-size: 0.875rem;
      animation: slideIn 0.3s ease-out;

      svg {
        width: 1.25rem;
        height: 1.25rem;
        flex-shrink: 0;
      }

      &--success {
        background: #e8f5e9;
        color: var(--color-success);
        border: 1px solid #c8e6c9;
      }

      &--error {
        background: #ffebee;
        color: var(--color-error);
        border: 1px solid #ffcdd2;
      }
    }
  }

  /* Animations */
  @keyframes slideIn {
    from {
      transform: translateY(-10px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Responsive */
  @media (max-width: 768px) {
    main {
      padding: 1rem;
    }

    .customer.login {
      .container {
        padding: 1.5rem;
      }

      .link-group a {
        display: block;
        margin: 0.75rem 0;
      }
    }
  }
</style>

<script>
  $(document).ready(function(){
    $("#submit_reset_btn").click(function(){
      localStorage.setItem("reset_password", true);
      var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
      var email = $("#recover-email").val();

      if(!filter.test(email)){
        $("#recover-email").css("border-color","red");
        return false;
      }

      if ($.trim($("#recover-email").val()) != "") {
        $("#rst_popup").submit();
      }
      else {
        return false;
      }
    });
  });
</script>

{% schema %}
    {
        "name": "Reset Password",
        "settings": [

            {
                "type": "text",
                "id": "rst_titl",
                "label": "Title",
                "default": "Reset Password"
            },
            {
                "type": "text",
                "id": "rst_sbtitl",
                "label": "Subtitle",
                "default": "We'll send you an email to reset your password."
            },
            {
                "type": "header",
                "content": "Image Section Start"
            },
            {
                "type": "image_picker",
                "id": "rst_img",
                "label": "Select Image"
            },
            {
                "type": "text",
                "id": "rst_mbltitl",
                "label": "Mobile Title",
                "default": "Reset Password"
            },
            {
                "type": "textarea",
                "id": "rst_mbldes",
                "label": "Mobile Description",
                "default": "We'll send you an email to reset your password."
            }

        ],

        "presets":[
            {
                "name": "Reset Password",
                "category": "Account"
            }
        ]
    }
{% endschema %}