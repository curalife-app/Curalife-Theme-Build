{% if product.tags contains 'sleep' %}
	{% assign bg_color = 'var(--light-turquoise)' %}
	{% assign number_color = 'var(--dark-turquoise)' %}
	{% assign link_color = 'var(--dark-turquoise)' %}
{% elsif product.tags contains 'joint' %}
	{% assign bg_color = 'var(--light-purple)' %}
	{% assign number_color = 'var(--purple)' %}
	{% assign link_color = 'var(--dark-purple)' %}
{% elsif product.tags contains 'immune' %}
	{% assign bg_color = 'var(--light-purple)' %}
	{% assign number_color = 'var(--purple)' %}
	{% assign link_color = 'var(--dark-purple)' %}
{% elsif product.tags contains 'multivitamin' %}
	{% assign bg_color = 'var(--lighter-peach)' %}
	{% assign number_color = 'var(--peach)' %}
	{% assign link_color = 'var(--dark-peach)' %}
{% endif %}

<section class="pack-info-section instance-{{ index }}">
	<div class="container">
		<div class="wrap mbl:flex-col mbl:items-center flex gap-4">
			<div class="titles mbl:flex-col mbl:items-baseline gap-2">
				<h2 class="title">{{ product.title }}</h2>
				<div class="subtitle">{{ product.description }}</div>

				<ul class="highlights check-list">
					{% for highlight in product.metafields.custom['product-highlights'].value %}
						<li class="highlight">
							<b>{{ highlight.title }}</b>
							<br>
							{{ highlight.subtitle }}
						</li>
					{% endfor %}
				</ul>
			</div>

			<img class="product-image" src="{{ product.metafields.custom.pill_image | img_url: 'original' }}" alt="{{ product.title }}" loading="lazy">
		</div>

		<div class="tabbed-content tabs-side">
			<nav class="tabs">
				<div class="tab">
					<a href="#instructions-{{ index }}">
						Usage Instructions
						<i>></i>
					</a>
				</div>
				{% if product.metafields.custom.ingredients.value %}
					<div class="tab">
						<a href="#ingredients-{{ index }}">
							Ingredients
							<i>></i>
						</a>
					</div>
				{% endif %}
				<div class="tab">
					<a href="#facts-{{ index }}">
						Supplement Facts
						<i>></i>
					</a>
				</div>
			</nav>

			<div class="content">
				<!-- Usage Instructions -->
				<div id="instructions-{{ index }}" class="item" data-title="Usage Instructions">
					<!-- Desktop header -->
					<h3 class="desktop-header">Usage Instructions</h3>
					<div class="instructions item-content">
						{% for step in product.metafields.custom.instructions.value %}
							<div class="step">
								<div class="capsules">
									{% for item in (1..step.capsules) %}
										{% if product.tags contains 'gummies' %}
											<img class="gummies m-0" src="{{ "icon-gummy.png" | asset_url }}" width="20" height="31" alt="Capsule Pill" loading="lazy">
										{% else %}
											<img class="caps m-0" src="{{ "icon-capsule.png" | asset_url }}" width="20" height="31" alt="Capsule Pill" loading="lazy" style="min-width: 35px">
										{% endif %}
									{% endfor %}
								</div>
								<div>{{ step.subtitle }}</div>
							</div>
						{% endfor %}
					</div>
				</div>

				{% if product.metafields.custom.ingredients.value %}
					<!-- Ingredients -->
					<div id="ingredients-{{ index }}" class="item" data-title="Ingredients">
						<!-- Desktop header -->
						<h3 class="desktop-header">Ingredients</h3>
						<div class="ingredients item-content">
							{% for ingredient in product.metafields.custom.ingredients.value %}
								<div class="ingredient">
									{% assign ingredient_handle = ingredient | downcase | replace: ' ', '-' %}
									<img src="{{ "product-supplement-pack-info-ingredient-icon-" | append: ingredient_handle | append: ".png" | asset_url }}" alt="Ingredient" loading="lazy">
									<p>{{ ingredient }}</p>
								</div>
							{% endfor %}
						</div>
					</div>
				{% endif %}

				<!-- Supplement Facts -->
				<div id="facts-{{ index }}" class="item" data-title="Supplement Facts">
					<!-- Desktop header -->
					<h3 class="desktop-header">Supplement Facts</h3>
					<div class="facts item-content">
						<img src="{{ product.metafields.custom.supplement_fact | image_url }}" alt="Supplement Facts" loading="lazy">
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<style>
	/* General Styles */
	.pack-info-section {
		background: var(--primary-color-lightest);
	}
	/* (Include any other general styles you already have) */

	/* Mobile Styles (max-width: 768px) */
	@media all and (max-width: 768px) {
		.pack-info-section {
			padding-bottom: 75vw;
			padding-top: 10vw;
		}
		.pack-info-section .instructions .step .capsules {
			min-width: 65px;
		}
		.pack-info-section .tabbed-content {
			display: block;
			margin-left: unset !important;
		}
		/* Accordion indicator */
		.pack-info-section .item::after {
			content: "+";
			font-size: 30px;
			position: absolute;
			top: 5px;
			right: 2vw;
			border: 2px solid var(--light-green);
			border-radius: 50%;
			width: 5vw;
			height: 5vw;
			font-size: 5vw;
			display: flex;
			align-items: center;
			justify-content: center;
			color: var(--light-green);
		}
		.pack-info-section .item.active::after {
			content: "-";
		}
		.pack-info-section .product-image-wrapper {
			bottom: 0;
			width: 100%;
			position: relative;
			text-align: center;
			margin-top: 10vw;
		}
		.pack-info-section .tabbed-content .item.active .item-content {
			padding: 5vw 0;
		}
		.pack-info-section .ingredient {
			width: 27vw;
		}
		.pack-info-section .instructions .step {
			gap: 2vw;
		}
		.pack-info-section .instructions .step h3 {
			min-width: 20vw;
		}
		/* Hide the extra desktop header on mobile */
		.desktop-header {
			display: none;
		}
	}

	/* Desktop Styles (min-width: 800px) */
	@media all and (min-width: 800px) {
		/* Show the desktop headers */
		.desktop-header {
			display: block;
			font-size: 1.5em;
			font-weight: bold;
			margin-bottom: 1em;
			text-align: center;
		}
		/* Layout adjustments for side‑by‑side display */
		.pack-info-section .tabbed-content {
			display: flex;
			flex-direction: row;
			align-items: flex-start;
			height: auto;
		}
		/* Hide the tabs navigation on desktop */
		.pack-info-section .tabbed-content .tabs {
			display: none;
		}
		.pack-info-section .tabbed-content .content {
			display: flex;
			gap: 20px;
			width: 100%;
		}
		.pack-info-section .tabbed-content .content .item {
			flex: 1;
			position: relative;
		}
		.pack-info-section .tabbed-content .item .item-content {
			opacity: 1 !important;
			visibility: visible !important;
			height: auto !important;
			padding: 10px; /* Adjust as needed */
		}
		/* Remove mobile accordion pseudo‑elements on desktop */
		.pack-info-section .item::before,
		.pack-info-section .item::after {
			display: none;
		}
	}
</style>

<script>
	(function () {
		function tabControl() {
			const instanceSelector = '.pack-info-section.instance-{{ index }}';
			const tabbedContent = document.querySelector(instanceSelector + ' .tabbed-content');
			if (!tabbedContent) return;

			if (window.innerWidth > 768) {
				// Desktop: ensure all items are visible.
				document.querySelectorAll(instanceSelector + ' .tabbed-content .item').forEach(function(item) {
					item.classList.add('active');
				});
			} else {
				// Mobile: initialize tab/accordion functionality.
				document.querySelectorAll(instanceSelector + ' .tabbed-content .item').forEach(function(item) {
					item.classList.remove('active');
				});
				const tabsNav = document.querySelector(instanceSelector + ' .tabbed-content .tabs');
				if (tabsNav && tabsNav.offsetParent !== null) {
					tabsNav.querySelectorAll('a').forEach(function (button) {
						button.addEventListener('click', function (event) {
							event.preventDefault();
							const target = button.getAttribute('href');
							// Remove active states.
							tabsNav.querySelectorAll('a').forEach(btn => btn.classList.remove('active'));
							document.querySelectorAll(instanceSelector + ' .tabbed-content .item').forEach(item => item.classList.remove('active'));
							// Activate the clicked tab and corresponding content.
							button.classList.add('active');
							document.querySelector(target).classList.add('active');
						});
					});
				} else {
					// Fallback: toggle on item click.
					document.querySelectorAll(instanceSelector + ' .tabbed-content .item').forEach(function (item) {
						item.addEventListener('click', function () {
							const container = item.closest('.tabbed-content');
							container.querySelectorAll('.item').forEach(it => it.classList.remove('active'));
							item.classList.add('active');
						});
					});
				}
			}
		}

		tabControl();

		let resizeTimer;
		window.addEventListener('resize', function () {
			clearTimeout(resizeTimer);
			resizeTimer = setTimeout(function () {
				tabControl();
			}, 250);
		});
	})();
</script>
