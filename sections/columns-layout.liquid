{% comment %}
	Section that provides a flexible column layout.
	Merchants add 'Column Content' blocks, which then accept nested content blocks.
{% endcomment %}

{% assign section_id = section.id %}
{% assign columns = section.settings.columns | default: 2 %}
{% assign columns_mobile = section.settings.columns_mobile | default: 1 %}
{% assign column_gap = section.settings.column_gap | default: 4 %}

<style>
	#section-{{ section_id }} .columns-layout-grid {
	  grid-template-columns: repeat({{ columns }}, minmax(0, 1fr));
	  gap: {{ column_gap }}rem; /* Adjust unit if needed */
	}
	@media (max-width: 768px) {
	  #section-{{ section_id }} .columns-layout-grid {
	    grid-template-columns: repeat({{ columns_mobile }}, minmax(0, 1fr));
	     gap: {{ column_gap | times: 0.75 | default: 1 }}rem; /* Smaller gap on mobile */
	  }
	  #section-{{ section_id }} .columns-layout-grid > div[style*="grid-column-start"] {
	    grid-column-start: auto !important;
	    grid-column-end: auto !important;
	  }
	}
</style>

<section
	id="section-{{ section_id }}"
	class="columns-layout-section"
	data-section-id="{{ section_id }}"
	data-section-type="columns-layout">
	<div class="container mx-auto px-4 py-8">
		{% if section.settings.title != blank %}
			<h2 class="text-center text-2xl mb-6">{{ section.settings.title }}</h2>
		{% endif %}

		<div class="columns-layout-grid grid">
			{% comment %} Loop through and render the 'Column Content' blocks {% endcomment %}
			{% for block in section.blocks %}
				{%- comment -%} Column width calculation based on block setting {%- endcomment -%}
				{%- assign col_width = block.settings.column_width | default: (12 | divided_by: columns) -%}
				{%- assign grid_col_style = 'grid-column: span ' | append: col_width | append: ' / span ' | append: col_width | append: ';' -%}
				<div style="{{ grid_col_style }}">
					{{ block }}
				</div>
			{% endfor %}
		</div>
	</div>
</section>

{% schema %}
	{
		"name": "Columns Layout",
		"tag": "section",
		"class": "columns-layout-section",
		"settings": [
			{
				"type": "text",
				"id": "title",
				"label": "Section Title (Optional)"
			},
			{
				"type": "range",
				"id": "columns",
				"label": "Columns (Desktop)",
				"min": 1,
				"max": 6,
				"step": 1,
				"default": 2
			},
			{
				"type": "range",
				"id": "columns_mobile",
				"label": "Columns (Mobile)",
				"min": 1,
				"max": 2,
				"step": 1,
				"default": 1
			},
			{
				"type": "range",
				"id": "column_gap",
				"label": "Column Gap (Desktop)",
				"min": 0,
				"max": 8,
				"step": 1,
				"unit": "rem",
				"default": 4
			}
			// Add settings for section padding, background, etc.
		],
		"blocks": [
			{
				"type": "column-content",
				"name": "Column"
				// Limit number of columns if needed using "limit"
			}
		],
		"presets": [
			{
				"name": "Columns Layout",
				"blocks": [{ "type": "column-content" }, { "type": "column-content" }]
			}
		]
	}
{% endschema %}
