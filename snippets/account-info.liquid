{% comment %}
  Account Information Snippet

  This snippet displays the customer's contact information and shipping address in the account page.
  It also handles displaying success messages after contact information is updated.

  Usage:
  {% render 'account-info' %}

  Dependencies:
  - Requires customer object to be available
  - Expects certain CSS classes to be defined in the parent template
  - Handles the contact-updated URL parameter for success messages
{% endcomment %}

<div class="profile-info-wrapper">
	<div class="contact-info">
		<h6 class="info-subtitle">Contact Details</h6>
		<ul class="no-style">
			<li><p>First Name<span>{{ customer.first_name }}</span></p></li>
			<li><p>Last Name<span>{{ customer.last_name }}</span></p></li>
			<li><p>Email<span>{{ customer.email }}</span></p></li>
		</ul>
	</div>

	<div class="shipping-info">
		<h6 class="info-subtitle">
			Shipping Address
			<a href="/account/addresses" class="address-edit-link" title="Manage Addresses">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
			</a>
		</h6>
		{% assign address = customer.default_address %}
		{% if address %}
			<div class="view_address">
				<p>{{ address.first_name }} {{address.last_name }}
				{% if address.company != blank %}<br />{{ address.company }}{% endif %}
				{% if address.street != blank %}<br />{{ address.street }}{% endif %}
				<br />{{ address.city }} {% if address.province_code != blank %}, {{ address.province_code }}{% endif %}
				<br />{{ address.country }} {{ address.zip }}
				{% if address.phone != blank %}<br />{{ address.phone }}</p>{% endif %}
			</div>
		{% else %}
			<div class="empty-text">
				<p>You don't have a shipping address yet. <a href="/account/addresses" class="add-address-link">Add one now</a></p>
			</div>
		{% endif %}
	</div>
</div>

<style>
.info-subtitle {
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.address-edit-link {
	color: var(--blue);
	transition: all 0.3s ease;
	display: flex;
	align-items: center;
}

.address-edit-link:hover {
	transform: translateY(-2px);
	opacity: 0.8;
}

.add-address-link {
	color: var(--blue);
	text-decoration: underline;
	font-weight: 600;
}

.add-address-link:hover {
	opacity: 0.8;
}
</style>

{% comment %}
  Success message handling for contact information updates
  This is shown when ?contact-updated=true is in the URL
{% endcomment %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Check for query parameter indicating successful update
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('contact-updated') === 'true') {
      // Show success message if not already displayed
      const contactInfo = document.querySelector('.contact-info');
      if (contactInfo && !contactInfo.querySelector('.success-message')) {
        const successDiv = document.createElement('div');
        successDiv.className = 'success-message';
        successDiv.innerHTML = '<p>Your contact information has been updated successfully!</p>';
        contactInfo.insertBefore(successDiv, contactInfo.firstChild);

        // Auto remove after 5 seconds
        setTimeout(() => {
          successDiv.remove();
          // Remove the query parameter
          const url = new URL(window.location);
          url.searchParams.delete('contact-updated');
          window.history.replaceState({}, '', url);
        }, 5000);
      }
    }
  });
</script>