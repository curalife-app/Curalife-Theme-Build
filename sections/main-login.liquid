{% comment %}
  Login and Password Recovery Component
  - Handles both login and password recovery forms
  - Uses CSS :target for form switching
  - Maintains accessibility standards
{% endcomment %}

<section class="customer login">
  <div class="container">
    {% comment %} Password Recovery Form {% endcomment %}
    <div class="recover-form" id="recover">
      <h2 tabindex="-1">{{ 'customer.recover_password.title' | t }}</h2>
      <p>{{ 'customer.recover_password.subtext' | t }}</p>

      {%- form 'recover_customer_password' -%}
        {% assign recover_success = form.posted_successfully? %}
        <div class="field">
          <input
            type="email"
            name="email"
            id="RecoverEmail"
            autocomplete="email"
            autocorrect="off"
            autocapitalize="off"
            {% if form.errors %}
              aria-invalid="true"
              aria-describedby="RecoverEmail-email-error"
              autofocus
            {% endif %}
            placeholder="{{ 'customer.login_page.email' | t }}"
          >
          <label for="RecoverEmail">{{ 'customer.login_page.email' | t }}</label>
        </div>

        {%- if form.errors -%}
          <div id="RecoverEmail-email-error" class="form__message form__message--error">
            {% render 'icon-error' %}
            {{ form.errors.messages.form }}
          </div>
        {%- endif -%}

        <div class="button-group">
          <button type="submit" class="button button--primary">
            {{ 'customer.login_page.submit' | t }}
          </button>
          <a href="#login" class="button button--secondary">
            {{ 'customer.login_page.cancel' | t }}
          </a>
        </div>
      {%- endform -%}
    </div>

    {% comment %} Login Form {% endcomment %}
    <div class="login-form" id="login">
      <h1 tabindex="-1">{{ 'customer.login_page.title' | t }}</h1>

      {%- if recover_success == true -%}
        <div class="form__message form__message--success" tabindex="-1" autofocus>
          {% render 'icon-success' %}
          {{ 'customer.recover_password.success' | t }}
        </div>
      {%- endif -%}

      {%- form 'customer_login', novalidate: 'novalidate' -%}
        {%- if form.errors -%}
          <div class="form__message form__message--error" tabindex="-1" autofocus>
            {% render 'icon-error' %}
            {{ form.errors | default_errors }}
          </div>
        {%- endif -%}

        <div class="field">
          <input
            type="email"
            name="customer[email]"
            id="CustomerEmail"
            autocomplete="email"
            autocorrect="off"
            autocapitalize="off"
            {% if form.errors contains 'form' %}
              aria-invalid="true"
            {% endif %}
            placeholder="{{ 'customer.login_page.email' | t }}"
          >
          <label for="CustomerEmail">{{ 'customer.login_page.email' | t }}</label>
        </div>

        {%- if form.password_needed -%}
          <div class="field">
            <input
              type="password"
              name="customer[password]"
              id="CustomerPassword"
              autocomplete="current-password"
              {% if form.errors contains 'form' %}
                aria-invalid="true"
              {% endif %}
              placeholder="{{ 'customer.login_page.password' | t }}"
            >
            <label for="CustomerPassword">{{ 'customer.login_page.password' | t }}</label>
          </div>
        {%- endif -%}

        <button type="submit" class="button button--primary">
          {{ 'customer.login_page.sign_in' | t }}
        </button>

        <div class="link-group">
          <a href="#recover">{{ 'customer.login_page.forgot_password' | t }}</a>
          <a href="{{ routes.account_register_url }}">{{ 'customer.login_page.create_account' | t }}</a>
          {% if shop.name == 'CuraLife' %}
            <a href="https://b2b.curalife.com" class="wholesale-link">
              {{ 'customer.login_page.wholesale_login' | t }}
            </a>
          {% endif %}
        </div>
      {%- endform -%}

      {% comment %} Guest Checkout {% endcomment %}
      {%- if shop.checkout.guest_login -%}
        <div class="guest-login">
          <hr>
          <h2>{{ 'customer.login_page.guest_title' | t }}</h2>
          {%- form 'guest_login' -%}
            <button type="submit" class="button button--secondary">
              {{ 'customer.login_page.guest_continue' | t }}
            </button>
          {%- endform -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<style>
  /* Base Styles */
  :root {
    --form-max-width: 450px;
    --form-padding: clamp(20px, 5vw, 40px);
    --input-height: 48px;
    --border-radius: 6px;

    /* Colors - Using CSS variables for theming */
    --color-primary: var(--primary-color, #4a7c7d);
    --color-primary-dark: var(--primary-color-dark, #3a6162);
    --color-text: var(--heading-color, #2c3338);
    --color-text-light: #666;
    --color-border: #ddd;
    --color-error: #d63301;
    --color-success: #2e7d32;

    /* Shadows */
    --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.1);
    --shadow-focus: 0 0 0 2px rgba(74, 124, 125, 0.1);
  }

  main {
    background-color: var(--beige);
  }

  /* Layout */
  .customer.login {
    width: min(var(--form-max-width), 100%);
    margin: 0 auto;

    .container {
      background: var(--color-background);
      border-radius: var(--border-radius);
      padding: var(--form-padding);
      box-shadow: var(--shadow-card);
    }

    /* Typography */
    h1, h2 {
      color: var(--color-text);
      text-align: center;
      margin-bottom: 1.5em;
      font-size: clamp(24px, 5vw, 28px);
    }

    p {
      color: var(--color-text-light);
      text-align: center;
      margin-bottom: 1.5em;
    }

    /* Form Fields */
    .field {
      position: relative;
      margin-bottom: 1.25em;

      input {
        width: 100%;
        height: var(--input-height);
        padding: 0.75em 1em;
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius);
        font-size: 1rem;
        background: var(--color-background);
        transition: 0.2s ease-in-out;
        transition-property: border-color, box-shadow;

        &:focus {
          outline: none;
          border-color: var(--color-primary);
          box-shadow: var(--shadow-focus);
        }

        &::placeholder {
          color: transparent;
        }

        &:focus + label,
        &:not(:placeholder-shown) + label {
          top: 0;
          transform: translateY(-50%);
          font-size: 0.875rem;
          color: var(--color-primary);
        }
      }

      label {
        position: absolute;
        left: 1em;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1rem;
        color: var(--color-text-light);
        background: var(--color-background);
        padding: 0 0.25em;
        transition: 0.2s ease-in-out;
        transition-property: top, transform, font-size, color;
      }
    }

    /* Buttons */
    .button {
      display: inline-block;
      width: 100%;
      padding: 0.875em;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;

      &--primary {
        background: var(--color-primary);
        color: white;

        &:hover {
          background: var(--color-primary-dark);
        }
      }

      &--secondary {
        background: transparent;
        color: var(--color-primary);
        text-decoration: none;

        &:hover {
          text-decoration: underline;
        }
      }
    }

    /* Links */
    .link-group {
      margin-top: 1.25em;

      a {
        display: block;
        color: var(--color-primary);
        text-decoration: none;
        text-align: center;
        font-size: 0.875rem;
        margin: 0.75em 0;
        transition: color 0.2s ease-in-out;

        &:hover {
          color: var(--color-primary-dark);
          text-decoration: underline;
        }
      }
    }

    /* Messages */
    .form__message {
      display: flex;
      align-items: center;
      gap: 0.5em;
      margin-bottom: 1.25em;
      padding: 0.75em;
      border-radius: var(--border-radius);
      font-size: 0.875rem;

      svg {
        width: 1em;
        height: 1em;
        flex-shrink: 0;
      }

      &--success {
        background: #e8f5e9;
        color: var(--color-success);
      }

      &--error {
        background: var(--light-peach, #fff3f3);
        color: var(--color-error);
      }
    }

    /* Form Switching */
    #recover,
    #recover + .recover-form {
      display: none;
    }

    #recover:target,
    #recover:target + .recover-form {
      display: block;
    }

    #recover:target ~ .login-form {
      display: none;
    }

    /* Guest Login */
    .guest-login {
      margin-top: 2em;
    }

    hr {
      border: none;
      border-top: 1px solid var(--color-border);
      margin: 2em 0;
    }

    /* Button Groups */
    .button-group {
      display: grid;
      gap: 0.75em;
    }
  }

  /* Utilities */
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .customer.login .container {
      padding: var(--form-padding);
    }
  }
</style>

{% schema %}
{
  "name": "t:sections.main-login.name",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
