{%- comment -%} If store is US {%- endcomment -%}
{% if shop.name == 'CuraLife' %}
  {% assign invoice_id = "51da85a3c3dfa1f360b48852b64218b2" %}
  {% assign manage_subscription_url = '/tools/recurring/login' %}
{% elsif shop.name == "CuraLife Global" %}
  {% assign invoice_id = "656f0dbf9392657eed7feefc486781fb" %}
  {% assign manage_subscription_url = '/pages/manage-my-subscriptions' %}
{% endif %}

{% if customer.tags contains 'curalifer' %}
  {% assign show_curalifer_tab = true %}
{% endif %}

<section class="account-page bg-gray-50 min-h-screen py-8">
  <div class="max-w-7xl container px-4 mx-auto">
    <h1 class="mb-8 text-3xl font-bold text-center text-gray-800">My Account</h1>

    <div id="tabs" class="rounded-xl overflow-hidden bg-white shadow-lg">
      <div class="account-content lg:flex-row flex flex-col">
        <!-- Desktop Menu -->
        <div class="account-menu desktop lg:block w-72 hidden bg-white border-r border-gray-200">
          <div class="menu-list p-4">
            <div class="tabs space-y-2">
              {% if show_curalifer_tab %}
                <div class="tab">
                  <a href="#curalifer" class="hover:bg-blue-50 flex items-center p-3 transition-all rounded-lg">
                    <i class="fa-thin fa-user-crown w-5 h-5 text-blue-600"></i>
                    <span class="ml-3 font-medium text-gray-700">Curalifer</span>
                  </a>
                </div>
              {% endif %}

              <div class="tab">
                <a href="#a" class="hover:bg-blue-50 flex items-center p-3 transition-all rounded-lg">
                  <i class="fa-thin fa-user w-5 h-5 text-blue-600"></i>
                  <span class="ml-3 font-medium text-gray-700">My Profile</span>
                </a>
              </div>

              <div class="tab">
                <a href="#b" class="hover:bg-blue-50 flex items-center p-3 transition-all rounded-lg">
                  <i class="fa-thin fa-credit-card w-5 h-5 text-blue-600"></i>
                  <span class="ml-3 font-medium text-gray-700">Orders</span>
                </a>
              </div>

              <div class="tab">
                <a href="#e" class="hover:bg-blue-50 flex items-center p-3 transition-all rounded-lg">
                  <i class="fa-thin fa-people-group w-5 h-5 text-blue-600"></i>
                  <span class="ml-3 font-medium text-gray-700">Loyalty</span>
                </a>
              </div>

              <div class="tab">
                <a href="#f" class="hover:bg-blue-50 flex items-center p-3 transition-all rounded-lg">
                  <i class="fa-thin fa-key w-5 h-5 text-blue-600"></i>
                  <span class="ml-3 font-medium text-gray-700">Change Password</span>
                </a>
              </div>

              <a href="{{ manage_subscription_url }}" class="hover:bg-blue-50 flex items-center p-3 transition-all rounded-lg">
                <i class="fa-thin fa-calendar w-5 h-5 text-blue-600"></i>
                <span class="ml-3 font-medium text-gray-700">Subscriptions</span>
              </a>

              <a href="/account/logout" class="hover:bg-red-50 flex items-center p-3 transition-all rounded-lg">
                <i class="fa-thin fa-right-from-bracket w-5 h-5 text-red-600"></i>
                <span class="ml-3 font-medium text-red-600">Logout</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Mobile Dropdown -->
        <div class="account-menu-mobile lg:hidden p-4">
          <select id="mobile-dropdown" class="focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full p-3 border border-gray-200 rounded-lg shadow-sm">
            {% if show_curalifer_tab %}
              <option value="#curalifer">Curalifer</option>
            {% endif %}
            <option value="#a">My Profile</option>
            <option value="#b">Orders</option>
            <option value="#e">Loyalty</option>
            <option value="#f">Change Password</option>
            <option value="{{ manage_subscription_url }}">Subscriptions</option>
            <option value="/account/logout">Logout</option>
          </select>
        </div>

        <!-- Content Area -->
        <div class="account-data flex-1 min-h-[500px] relative">
          {% if show_curalifer_tab %}
            <div class="data-row absolute w-full" id="curalifer">
              <div class="p-6">
                <h2 class="mb-2 text-2xl font-bold text-gray-800">My Curalife</h2>
                <p class="mb-6 text-gray-600">Your exclusive access to our recipes and workouts to help you live a healthier life.</p>

                <div class="md:grid-cols-2 grid gap-6">
                  <div class="rounded-xl hover:shadow-md overflow-hidden transition-all bg-white shadow-sm">
                    <a href="/blogs/recipes" class="block">
                      <img src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/curalifer_recipies.png" alt="Curalife Recipes" class="object-cover w-full h-48">
                      <h5 class="p-4 text-lg font-semibold text-center text-gray-800">Recipes</h5>
                    </a>
                  </div>

                  <div class="rounded-xl hover:shadow-md overflow-hidden transition-all bg-white shadow-sm">
                    <a href="/blogs/workouts" class="block">
                      <img src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/curalifer_exercise.png" alt="Curalife Workouts" class="object-cover w-full h-48">
                      <h5 class="p-4 text-lg font-semibold text-center text-gray-800">Workouts</h5>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          {% endif %}

          <div class="data-row absolute w-full" id="a">
            <div class="p-6 space-y-6">
              <!-- Contact Information -->
              <div class="rounded-xl p-6 bg-white shadow-sm">
                <div class="flex items-center justify-between mb-6">
                  <h5 class="text-xl font-semibold text-gray-800">Contact Information</h5>
                  <a href="/account/addresses" class="hover:bg-blue-50 inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 transition-colors border border-blue-600 rounded-lg">
                    Edit
                  </a>
                </div>

                <div class="space-y-4">
                  <div class="flex justify-between py-3 border-b border-gray-100">
                    <span class="text-gray-600">First Name</span>
                    <span class="font-semibold text-gray-800">{{ customer.first_name }}</span>
                  </div>
                  <div class="flex justify-between py-3 border-b border-gray-100">
                    <span class="text-gray-600">Last Name</span>
                    <span class="font-semibold text-gray-800">{{ customer.last_name }}</span>
                  </div>
                  <div class="flex justify-between py-3">
                    <span class="text-gray-600">Email</span>
                    <span class="font-semibold text-gray-800">{{ customer.email }}</span>
                  </div>
                </div>
              </div>

              <!-- Shipping Address -->
              <div class="rounded-xl p-6 bg-white shadow-sm">
                <div class="flex items-center justify-between mb-6">
                  <h5 class="text-xl font-semibold text-gray-800">Shipping Address</h5>
                  <a href="/account/addresses" class="hover:bg-blue-50 inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 transition-colors border border-blue-600 rounded-lg">
                    {% if address %}Edit{% else %}Add Address{% endif %}
                  </a>
                </div>

                {% assign address = customer.default_address %}
                {% if address %}
                  <div class="space-y-2 text-gray-700">
                    <p class="font-medium">{{ address.first_name }} {{address.last_name }}</p>
                    {% if address.company != blank %}<p>{{ address.company }}</p>{% endif %}
                    {% if address.street != blank %}<p>{{ address.street }}</p>{% endif %}
                    <p>{{ address.city }}{% if address.province_code != blank %}, {{ address.province_code }}{% endif %}</p>
                    <p>{{ address.country }} {{ address.zip }}</p>
                    {% if address.phone != blank %}<p>{{ address.phone }}</p>{% endif %}
                  </div>
                {% else %}
                  <div class="py-8 text-center">
                    <i class="fa-thin fa-home mb-3 text-4xl text-gray-400"></i>
                    <p class="text-gray-600">You don't have a shipping address yet.</p>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="data-row absolute w-full" id="b">
            <div class="p-6">
              {% render 'account-orders' %}
            </div>
          </div>

          <div class="data-row absolute w-full" id="e">
            <div class="p-6">
              {% render 'account-rewards' %}
            </div>
          </div>

          <div class="data-row absolute w-full" id="f">
            <div class="p-6">
              {% render 'account-change-password' %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
:root {
  --primary: var(--curalin);
  --transition: 0.3s ease-in-out;
}

.data-row {
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--transition);
}

.data-row.active {
  opacity: 1;
  pointer-events: auto;
}

/* Active tab styles */
.tab a.active {
  background-color: rgb(239 246 255);
  color: rgb(37 99 235);
}

/* Form styles */
.form-wrap {
  max-width: 600px;
  margin: auto;
}

.form-fields {
  display: grid;
  gap: 1rem;
}

.form-fields label {
  display: block;
}

.form-fields input {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 1px solid rgb(229 231 235);
  border-radius: 0.5rem;
  transition: all var(--transition);
}

.form-fields input:focus {
  outline: none;
  border-color: rgb(37 99 235);
  box-shadow: 0 0 0 3px rgb(191 219 254);
}

/* Button styles */
.main-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.5rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  background-color: rgb(37 99 235);
  color: white;
  border-radius: 0.5rem;
  transition: all var(--transition);
}

.main-btn:hover {
  background-color: rgb(29 78 216);
}

.main-btn.blank {
  background-color: transparent;
  border: 1px solid rgb(37 99 235);
  color: rgb(37 99 235);
}

.main-btn.blank:hover {
  background-color: rgb(239 246 255);
}

@media (max-width: 1024px) {
  .account-content {
    gap: 1rem;
  }

  .account-data .data-row .data-wrap {
    min-width: 100%;
  }
}

@media (max-width: 768px) {
  .account-menu {
    width: 100%;
  }

  .account-data {
    margin-top: 1rem;
  }
}
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Cache DOM elements
    const elements = {
      accountData: document.querySelector('.account-data'),
      tabs: document.querySelector('#tabs'),
      mobileDropdown: document.querySelector('#mobile-dropdown')
    };

    // Early return if required elements are missing
    if (!elements.accountData || !elements.tabs || !elements.mobileDropdown) {
      console.error("Required elements not found");
      return;
    }

    // Cache tab-related elements
    const tabElements = {
      links: [...elements.tabs.querySelectorAll('.tabs .tab a')],
      panes: [...elements.tabs.querySelectorAll('.account-data .data-row')]
    };

    // Helper functions
    const updateTabPane = (tabPane) => {
      if (!tabPane) return;

      const tabPaneWrap = tabPane.querySelector('.data-wrap');
      if (tabPaneWrap) {
        elements.accountData.style.height = `${tabPaneWrap.offsetHeight}px`;
      }
    };

    const resetTabs = () => {
      tabElements.panes.forEach(pane => {
        pane.classList.remove("active");
        pane.style.pointerEvents = "none";
      });
      tabElements.links.forEach(link =>
        link.parentElement.classList.remove("active")
      );
    };

    const setActiveTab = (targetLink) => {
      if (!targetLink) return;

      resetTabs();

      const href = targetLink.getAttribute('href')?.substr(1);
      const tabPane = href ? document.getElementById(href) : null;

      if (tabPane) {
        tabPane.classList.add("active");
        tabPane.style.pointerEvents = "auto";
        updateTabPane(tabPane);
      }

      targetLink.parentElement.classList.add("active");
    };

    // Event handlers
    const handleTabClick = (e) => {
      e.preventDefault();
      setActiveTab(e.target);
    };

    const handleTransitionEnd = () => {
      const activePane = elements.tabs.querySelector('.data-row.active');
      if (activePane) {
        elements.accountData.style.height = `${activePane.clientHeight}px`;
      }
    };

    const handleMobileDropdown = (e) => {
      const value = e.target.value;
      if (value.charAt(0) !== '#') {
        window.location.href = value;
        return;
      }

      const tabLink = elements.tabs.querySelector(`.tabs .tab a[href="${value}"]`);
      if (tabLink) {
        setActiveTab(tabLink);
      }
    };

    // Initialize and attach event listeners
    if (tabElements.links.length) {
      setActiveTab(tabElements.links[0]);
    }

    tabElements.links.forEach(link =>
      link.addEventListener('click', handleTabClick)
    );

    tabElements.panes.forEach(pane =>
      pane.addEventListener('transitionend', handleTransitionEnd)
    );

    elements.mobileDropdown.addEventListener('change', handleMobileDropdown);
  });
</script>

{% schema %}
{
  "name": "My Account",
  "settings": [
    {
      "type": "text",
      "id": "acnt_titl",
      "label": "Title",
      "default": "Enter Title"
    }, {
      "type": "header",
      "content": "Order Section Start"
    }, {
      "id": "ord_btnlink",
      "type": "url",
      "label": "Button Link"
    }
  ],
  "presets": [
    {
      "name": "My Account",
      "category": "Account"
    }
  ]
}
{% endschema %}