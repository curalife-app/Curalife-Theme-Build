{% comment %}
  Account Information Snippet

  This snippet displays the customer's contact information and shipping address in the account page.
  It also handles displaying success messages after contact information is updated.

  Usage:
  {% render 'account-info' %}

  Dependencies:
  - Requires customer object to be available
  - Expects certain CSS classes to be defined in the parent template
  - Handles the contact-updated URL parameter for success messages
{% endcomment %}

<div class="profile-info-wrapper">
	<div class="contact-info">
		<h6 class="info-subtitle">Contact Details</h6>
		<ul class="no-style">
			<li><p>First Name<span>{{ customer.first_name }}</span></p></li>
			<li><p>Last Name<span>{{ customer.last_name }}</span></p></li>
			<li><p>Email<span>{{ customer.email }}</span></p></li>
		</ul>
		<div class="data-btn mt-4">
			<a class="main-btn blank btn-sm open-modal" href="#edit-contact-modal">Edit Contact Info</a>
		</div>
	</div>

	<div class="shipping-info">
		<h6 class="info-subtitle">Shipping Address</h6>
		{% assign address = customer.default_address %}
		{% if address %}
			<div class="view_address">
				<p>{{ address.first_name }} {{address.last_name }}
				{% if address.company != blank %}<br />{{ address.company }}{% endif %}
				{% if address.street != blank %}<br />{{ address.street }}{% endif %}
				<br />{{ address.city }} {% if address.province_code != blank %}, {{ address.province_code }}{% endif %}
				<br />{{ address.country }} {{ address.zip }}
				{% if address.phone != blank %}<br />{{ address.phone }}</p>{% endif %}
			</div>
		{% else %}
			<div class="empty-text">
				<p>You don't have a shipping address yet.</p>
			</div>
		{% endif %}
		<div class="data-btn mt-4">
			<a class="main-btn blank btn-sm" href="/account/addresses">Manage Addresses</a>
		</div>
	</div>
</div>

{% comment %}
  Success message handling for contact information updates
  This is shown when ?contact-updated=true is in the URL
{% endcomment %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Check for query parameter indicating successful update
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('contact-updated') === 'true') {
      // Show success message if not already displayed
      const contactInfo = document.querySelector('.contact-info');
      if (contactInfo && !contactInfo.querySelector('.success-message')) {
        const successDiv = document.createElement('div');
        successDiv.className = 'success-message';
        successDiv.innerHTML = '<p>Your contact information has been updated successfully!</p>';
        contactInfo.insertBefore(successDiv, contactInfo.firstChild);

        // Auto remove after 5 seconds
        setTimeout(() => {
          successDiv.remove();
          // Remove the query parameter
          const url = new URL(window.location);
          url.searchParams.delete('contact-updated');
          window.history.replaceState({}, '', url);
        }, 5000);
      }
    }
  });
</script>