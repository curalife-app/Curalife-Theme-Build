<section>
  <div class="container">
    {% render 'title', section_id: section.id, title: '<span>One Capsule,</span> Triple Action', title_tag: 'h2', subtitle: '100% Natural, No Shots, No Chemicals', span_color: section.settings.title_highlight_color, padding_bottom: '30', padding_top: 0 %}

    <div class="capsule-animation mt-8">
      <div class="pill flex justify-center">
        <img class="pill-half left m-0" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/pill-half.png?v=1723722706" alt="Curaslim 2024 Capsule Animation Pill Half">
        <img class="pill-half right m-0 scale-x-[-1]" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/pill-half.png?v=1723722706" alt="Curaslim 2024 Capsule Animation Pill Half">
      </div>
    </div>
  </div>
</section>

<style>
  .capsule-animation {
    position: relative;
    overflow: hidden;
  }

  .pill-half {
    opacity: 0; /* Initially hidden */
    transition: opacity 0.5s ease-in-out;
  }

  .pill-half.animate {
    opacity: 1;
  }

  .pill-half.left {
    animation: openPillLeft 2s ease forwards;
  }

  .pill-half.right {
    animation: openPillRight 2s ease forwards;
  }

  @keyframes openPillLeft {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(180deg);
    }
  }

  @keyframes openPillRight {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(-180deg);
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const pillLeft = document.querySelector('.pill-half.left');
    const pillRight = document.querySelector('.pill-half.right');
    const capsuleAnimation = document.querySelector('.capsule-animation');

    const observerOptions = {
      root: null, // Use the viewport as the root
      threshold: 0.5 // Trigger when 50% of the element is in view
    };

    const observer = new IntersectionObserver(function(entries, observer) {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          pillLeft.classList.add('animate');
          pillRight.classList.add('animate');
          observer.unobserve(capsuleAnimation); // Stop observing once animation has started
        }
      });
    }, observerOptions);

    observer.observe(capsuleAnimation);
  });
</script>

{% schema %}
  {
    "name": "Capsule Animation",
    "settings": [],
    "presets": [
      {
        "category": "Page",
        "name": "Capsule Animation"
      }
    ]
  }
{% endschema %}
