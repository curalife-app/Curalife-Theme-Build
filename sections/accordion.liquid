{% comment %}
	SECTION: accordion-component.liquid
	Purpose:
		- Left half: Background image (cover) with headline + optional subheading overlay.
		- Right half: White card with accordion items.
		- Tailwind classes used for layout & styling.
{% endcomment %}

<section id="accordion-component"
	class="flex flex-wrap items-stretch justify-between max-w-screen-xl mx-auto">

	<!-- LEFT COLUMN (Background Image + Text Overlay) -->
	<div class="relative flex-1 min-h-[500px] bg-cover bg-center"
			 style="
				 {% if section.settings.background_image != blank %}
					 background-image: url('{{ section.settings.background_image | image_url: width:1600 }}');
				 {% else %}
					 background-color: #ccc;
				 {% endif %}
			 ">
		<!-- Gradient overlay for improved text contrast -->
		<div class="bg-gradient-to-b from-black/10 to-black/40 absolute inset-0"></div>

		<!-- Text Overlay -->
		<div class="absolute bottom-8 left-8 z-10 text-white max-w-[80%]">
			{% if section.settings.heading != blank %}
				<h2 class="mb-2 text-2xl leading-tight">
					{{ section.settings.heading }}
				</h2>
			{% endif %}

			{% if section.settings.subheading != blank %}
				<p class="text-base leading-snug">
					{{ section.settings.subheading }}
				</p>
			{% endif %}
		</div>
	</div>

	<!-- RIGHT COLUMN (Accordion Card) -->
	<div class="md:p-8 flex items-center justify-center flex-1 p-6">
		<div class="w-full max-w-[600px] bg-white rounded-lg shadow-md p-6 md:p-8">
			{% for block in section.blocks %}
				{% if block.type == 'accordion_item' %}
					<div class="accordion-item py-4 border-b border-gray-200">
						<div class="accordion-header flex items-center justify-between cursor-pointer">
							<span class="text-base font-semibold">
								{{ block.settings.month_title }}
							</span>
							<span class="accordion-icon ml-2 text-lg font-bold">+</span>
						</div>
						<!--
							We'll use a 'max-h-0' + 'overflow-hidden' for closed state.
							JavaScript sets inline 'max-height' to open it smoothly.
						-->
						<div class="accordion-content max-h-0 mt-2 overflow-hidden transition-all duration-300 ease-in-out">
							{% if block.settings.subtitle != blank %}
								<h4 class="mb-2 text-base font-normal">
									{{ block.settings.subtitle }}
								</h4>
							{% endif %}
							<p class="text-sm leading-relaxed">
								{{ block.settings.description }}
							</p>
						</div>
					</div>
				{% endif %}
			{% endfor %}
		</div>
	</div>

</section>

<!-- JavaScript for Accordion Toggle -->
<script>
document.addEventListener('DOMContentLoaded', function() {
	const accordionComponent = document.getElementById('accordion-component');
	if (!accordionComponent) return;

	const accordionHeaders = accordionComponent.querySelectorAll('.accordion-header');

	accordionHeaders.forEach(header => {
		header.addEventListener('click', function() {
			const parentItem = header.closest('.accordion-item');
			const content = parentItem.querySelector('.accordion-content');
			const icon = header.querySelector('.accordion-icon');

			// Close any other open items so only one is open at a time
			const allContents = accordionComponent.querySelectorAll('.accordion-content');
			allContents.forEach(otherContent => {
				if (otherContent !== content) {
					otherContent.style.maxHeight = null;
					const otherIcon = otherContent
						.closest('.accordion-item')
						.querySelector('.accordion-icon');
					if (otherIcon) otherIcon.textContent = '+';
				}
			});

			// Toggle the clicked item
			if (content.style.maxHeight && content.style.maxHeight !== '0px') {
				// Close
				content.style.maxHeight = '0px';
				icon.textContent = '+';
			} else {
				// Open
				content.style.maxHeight = content.scrollHeight + 'px';
				icon.textContent = '-';
			}
		});
	});
});
</script>

{% schema %}
{
	"name": "Accordion",
	"settings": [
		{
			"type": "text",
			"id": "heading",
			"label": "Main Heading",
			"default": "Your Journey: Shed Pounds & Feel Great"
		},
		{
			"type": "text",
			"id": "subheading",
			"label": "Subheading",
			"default": "Add a motivating line or supporting text here."
		},
		{
			"type": "image_picker",
			"id": "background_image",
			"label": "Background Image"
		}
	],
	"blocks": [
		{
			"type": "accordion_item",
			"name": "Accordion Item",
			"settings": [
				{
					"type": "text",
					"id": "month_title",
					"label": "Month Title",
					"default": "Month 3"
				},
				{
					"type": "text",
					"id": "subtitle",
					"label": "Subtitle",
					"default": "Getting Started"
				},
				{
					"type": "textarea",
					"id": "description",
					"label": "Description",
					"default": "Take the product twice a day to establish a routine. Consistent use will help reduce cravings and build healthy habits."
				}
			]
		}
	],
	"max_blocks": 12,
	"presets": [
		{
			"name": "Accordion",
			"category": "Custom"
		}
	]
}
{% endschema %}
