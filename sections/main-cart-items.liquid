{% comment %}Assumes existing cart.js is loaded{% endcomment %}
<script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>

<cart-items class="cart-items{% if cart == empty %} is-empty{% endif %}">
  <div class="title-wrapper-with-link">
    <h1>{{ 'sections.cart.title' | t }}</h1>
    <a href="{{ routes.all_products_collection_url }}">{{ 'general.continue_shopping' | t }}</a>
  </div>

  {% if cart == empty %}
    <div class="cart__warnings">
      <h2>{{ 'sections.cart.empty' | t }}</h2>
      <a href="{{ routes.all_products_collection_url }}" class="button">{{ 'general.continue_shopping' | t }}</a>

      {%- if shop.customer_accounts_enabled and customer == null -%}
        <p>{{ 'sections.cart.login.paragraph_html' | t: link: routes.account_login_url }}</p>
      {%- endif -%}
    </div>
  {% else %}
    <form action="{{ routes.cart_url }}" method="post" id="cart">
      <table>
        <thead>
          <tr>
            <th colspan="2">{{ 'sections.cart.headings.product' | t }}</th>
            <th>{{ 'sections.cart.headings.price' | t }}</th>
            <th>{{ 'sections.cart.headings.quantity' | t }}</th>
            <th>{{ 'sections.cart.headings.total' | t }}</th>
          </tr>
        </thead>
        <tbody>
          {%- for item in cart.items -%}
            {% liquid
              assign is_subscription = false
              if item.selling_plan_allocation != null
                assign is_subscription = true
              endif
            %}

            <tr class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
              <td class="cart-item__media">
                {% if item.image %}
                  <img src="{{ item.image | image_url: width: 150 }}"
                       alt="{{ item.image.alt | escape }}"
                       loading="lazy"
                       class="cart-item__image"
                       width="150"
                       height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}">
                {% endif %}
              </td>

              <td class="cart-item__details">
                <a href="{{ item.url }}" class="cart-item__name">{{ item.product.title }}</a>
                {% if item.original_price != item.final_price %}
                  <div class="cart-item__discounted-prices">
                    <span class="cart-item__old-price">{{ item.original_price | money }}</span>
                    <span>{{ item.final_price | money }}</span>
                  </div>
                {% else %}
                  <div>{{ item.original_price | money }}</div>
                {% endif %}

                {%- if item.product.has_only_default_variant == false -%}
                  {% for option in item.options_with_values %}
                    <div class="product-option">{{ option.name }}: {{ option.value }}</div>
                  {% endfor %}
                {%- endif -%}

                {% if is_subscription %}
                  <div class="product-option">{{ item.selling_plan_allocation.selling_plan.name }}</div>
                {% endif %}
              </td>

              <td class="cart-item__price">{{ item.original_price | money }}</td>

              <td class="cart-item__quantity">
                <div class="cart-item__quantity-wrapper">
                  {% if is_subscription %}
                    <input type="number" name="updates[]" value="{{ item.quantity }}" readonly class="quantity__input">
                  {% else %}
                    <quantity-input class="quantity">
                      <button class="quantity__button" name="minus" type="button">{% render 'icon-minus' %}</button>
                      <input type="number"
                             name="updates[]"
                             value="{{ item.quantity }}"
                             min="0"
                             id="Quantity-{{ item.index | plus: 1 }}"
                             class="quantity__input"
                             data-index="{{ item.index | plus: 1 }}">
                      <button class="quantity__button" name="plus" type="button">{% render 'icon-plus' %}</button>
                    </quantity-input>
                  {% endif %}

                  <cart-remove-button>
                    <a href="{{ item.url_to_remove }}">{% render 'icon-remove' %}</a>
                  </cart-remove-button>
                </div>
                <div class="cart-item__error" role="alert"></div>
              </td>

              <td class="cart-item__totals">
                <div class="loading-overlay hidden">
                  <div class="loading-overlay__spinner">{% render 'icon-spinner' %}</div>
                </div>

                {% if item.original_line_price != item.final_line_price %}
                  <div class="cart-item__discounted-prices">
                    <span class="cart-item__old-price">{{ item.original_line_price | money }}</span>
                    <span>{{ item.final_line_price | money }}</span>
                  </div>
                {% else %}
                  <span>{{ item.original_line_price | money }}</span>
                {% endif %}
              </td>
            </tr>
          {%- endfor -%}
        </tbody>
      </table>

      <div class="cart__footer">
        <div class="cart__summary">
          {%- if cart.cart_level_discount_applications.size > 0 -%}
            <div class="cart__discounts">
              {% for discount in cart.cart_level_discount_applications %}
                <div class="cart-discount">
                  {% render 'icon-discount' %}
                  {{ discount.title }}: -{{ discount.total_allocated_amount | money }}
                </div>
              {% endfor %}
            </div>
          {%- endif -%}

          <div class="cart__total">
            <span>{{ 'sections.cart.subtotal' | t }}</span>
            <span>{{ cart.total_price | money }}</span>
          </div>

          <small>{{ 'sections.cart.taxes_note' | t }}</small>

          <div class="cart__checkout">
            <button type="submit" name="checkout" class="button button--primary">
              {{ 'sections.cart.checkout' | t }}
            </button>
          </div>
        </div>
      </div>
    </form>
  {% endif %}
</cart-items>

{% schema %}
{
  "name": "Cart Items",
  "settings": []
}
{% endschema %}
