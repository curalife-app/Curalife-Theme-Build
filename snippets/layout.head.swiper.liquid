{% assign loadOnPages = "/pages/lp-wl-curaslim-360-price,/pages/reasons-why-curalin-for-blood-sugar-maintenance,/pages/lp-glu-4-reasons-select,/pages/lp-glu-curalin-v4-select,/pages/lp-wl-curaslim-prp-select,/pages/lp-wl-curaslim-360-select,/pages/glucose-support-curalin-pack-v4-new" | split: ',' %}
{% assign currentPage = request.path %}

{% if loadOnPages contains currentPage or currentPage contains '/products/' or Activate %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    window.isSwiperLoaded = true;
    console.log("Swiper loaded! (on Liquid)");
  </script>
{% endif %}

<script>
  window.isSwiperLoading = false;

  function loadSwiper(initializeCallback) {
    if (window.isSwiperLoaded) {
      console.log("Swiper already loaded, skipping load.");
      if (typeof initializeCallback === "function") {
        initializeCallback();
      }
      return;
    }

    if (!window.isSwiperLoading) {
      console.log("Loading Swiper...");
      window.isSwiperLoading = true;

      const link = document.createElement("link");
      link.rel = "stylesheet";
      link.href = "https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css";
      document.head.appendChild(link);

      const script = document.createElement("script");
      script.src = "https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js";
      script.onload = () => {
        window.isSwiperLoaded = true;
        window.isSwiperLoading = false;
        console.log("Swiper loaded! (on JS)");

        if (typeof initializeCallback === "function") {
          console.log("Calling initializeCallback after Swiper is loaded.");
          initializeCallback();
        }
      };
      script.onerror = () => {
        window.isSwiperLoading = false;
        console.error("Failed to load Swiper script.");
      };
      document.body.appendChild(script);
    } else {
      console.log("Swiper is currently loading, please wait.");
    }
  }

  function initializeSwiper(swiperElementSelector, swiperData = {}) {
    const defaultData = {
      loop: true,
      grabCursor: true,
      autoplay: false,
      speed: 300,
      slidesPerView: 1,
      spaceBetween: 0,
      direction: 'horizontal',
      effect: 'slide',
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    };

    const finalSwiperData = { ...defaultData, ...swiperData };

    // Only initialize Swiper if it's available
    if (typeof Swiper !== 'undefined') {
      try {
        console.log("Initializing Swiper with selector:", swiperElementSelector, "and data:", finalSwiperData);
        return new Swiper(swiperElementSelector, finalSwiperData);
      } catch (error) {
        console.error("Error initializing Swiper:", error);
      }
    } else {
      console.warn("Swiper is not defined. Initialization skipped.");
    }
  }
</script>